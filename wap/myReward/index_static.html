<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="http://common.huibaoming.cn/font-awesome/css/font-awesome.css">
    <link rel="stylesheet" href="http://common.huibaoming.cn/jquery-weui/css/weui.css">
    <link rel="stylesheet" href="../../oss/jquery-weui/css/jquery-weui.css">

    <link rel="stylesheet" href="../src/css/wap.css">
    <link rel="stylesheet" href="../src/css/wap_public.css">
    <link rel="stylesheet" href="../src/css/award.css">

</head>
<body ng-app="app" ng-controller="ctrl">
<div class="bg_bg"></div>
  <header class="fix_header">
      <center style="margin:1rem;">
          <div class="award_header">
              我的奖品
          </div>
      </center>
  </header>
    <section style="margin-top:5rem;margin-bottom:3rem;">
        <div class="cash_box car{{ item.id }}"  ng-repeat="item in list">
            <div class="weui-row">
                <div class="weui-col-75 pad-all3 pad-l5">
                    <p><span style="font-size:2rem;font-weight: bold" ng-bind="'￥'+item.price"></span><span class="mar-l4" ng-bind="item.award"></span></p>
                    <!--<span class="text-font5 mar-l2" ng-bind="item.status">教师专属</span>-->
                </div>
                <div class="weui-col-25">
                    <img src="http://common.huibaoming.cn/wap/images/haivit/status1.png" alt="" style="width:75%;float:right;margin-top:0.5rem;margin-right:0.5rem">
                </div>
            </div>
            <div class="weui-flex text-font3 cash_footer">
                <div class="weui-flex__item text-l"><span ng-bind="item.activity"></span></div>
                <div class="weui-flex__item text-r"><span ng-bind="item.time"></span></div>
            </div>
        </div>
        <center class="bc-text-header hide" ng-class="{'show':list.length==0}">
            <img src="http://common.huibaoming.cn/wap/images/haivit/no_award.png" alt="" style="width:65%">
            <h3>这里什么都没有</h3>
            <p>快去抽奖获得奖品吧</p>
        </center>

    </section>
    <footer style="position:fixed;left:0;right:0;bottom:0;">
        <img src="http://common.huibaoming.cn/wap/images/haivit/award_footer.png" alt="" style="width:100%">
    </footer>

</body>
<script src="http://common.huibaoming.cn/jquery/jquery.js"></script>
<script src="http://common.huibaoming.cn/jquery-weui/js/jquery-weui.js"></script>
<script src="http://common.huibaoming.cn/angular/angular.js"></script>
<script src="http://common.huibaoming.cn/swiper/js/swiper.js"></script>
<script>
    var kmy_app=angular.module('app',[]);
    kmy_app.controller('ctrl',function($scope,$http){
        //模拟数据
        $scope.list=[
            {activity:"新人摇红包",award:"现金红包",time:"2017-07-03",status:"已发放",id:1,price:25},
            {activity:"好评有礼",award:"现金红包",time:"2017-07-03",status:"已发放",id:2,price:25},
            {activity:"大转盘",award:"卡券",time:"2017-07-03",status:"未发放",id:'2',price:25},
            {activity:"过河拆桥",award:"积分",time:"2017-07-03",status:"已发放",id:3,price:25},
            {activity:"新人摇红包",award:"现金红包",time:"2017-07-03",status:"已发放",id:1,price:25},
            {activity:"新人摇红包",award:"现金红包",time:"2017-07-03",status:"已发放",id:1,price:25},
            {activity:"新人摇红包",award:"现金红包",time:"2017-07-03",status:"已发放",id:1,price:25}
           ];
        //加载更多数据
        $scope.doSearch = function(is_append) {
            var url = project_url + "/deal/index.do?is_json=2";
            var json_param = {};
            json_param['page'] = $scope.page;
            if ($scope.tab != -1) {
                json_param['type_id'] = $scope.json.type_list[$scope.tab].id;
            }

            $http({
                method : 'post',
                url : url,
                data : $.param(json_param),
                headers : {
                    'Content-Type' : 'application/x-www-form-urlencoded'
                }
            }).then(
                    function successCallback(data) {
                        if (is_append) {
                            if (data.data.deal_list.length > 0)
                                $scope.deal_list.push.apply($scope.deal_list,
                                        data.data.deal_list);
                            else {
                                $scope.has_data = false;
                            }
                        } else {
                            $scope.deal_list = data.data.deal_list;
                            if (data.data.deal_list.length == 0)
                                $scope.has_data = false;
                        }
                        $scope.page = $scope.page + 1;
                        $.hideLoading();
                        loading = false;
                        inf_allow = true;
                    }, function errorCallback(data) {
                        // 请求失败执行代码
                        console.log(data);
                    });
        };

        // 滚动加载
        var loading = false; // 状态标记
        var inf_allow = true; // 是否允许触发下拉事件
        $(document.body).infinite().on("infinite", function() {
            if (loading || !$scope.has_data || !inf_allow)
                return;
            $('.loadMore').removeClass('hide');
            $.showLoading();
            loading = true;
            $scope.doSearch(true);
            $('.loadMore').addClass('hide');
        });

    });

</script>
</html>